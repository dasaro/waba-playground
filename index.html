<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Cache-busting handled via ?v= version parameters on module imports -->

    <!-- CRITICAL: Set base URL for GitHub Pages project repository (conditional) -->
    <script>
        // Only set base tag for GitHub Pages, not for localhost
        if (window.location.hostname === 'dasaro.github.io') {
            const base = document.createElement('base');
            base.href = '/waba-playground/';
            document.head.appendChild(base);
        }
    </script>

    <title>WABA Playground - Interactive Framework Explorer</title>
    <link rel="stylesheet" href="style.css">
    <!-- vis.js for network visualization -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/vis-network/styles/vis-network.min.css">

    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Prism.js for syntax highlighting (minimal theme + core) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="modules/prism-waba.js?v=20260104-1"></script>

    <!-- Configure Emscripten Module BEFORE loading clingo.web.js -->
    <script src="modules/wasm-config.js?v=20260101-1"></script>
    <script src="clingo.web.js?v=20260101-9"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>WABA Playground</h1>
                <p class="subtitle">Interactive Weighted Assumption-Based Argumentation Framework Explorer</p>
            </div>
            <div class="header-links">
                <button id="font-decrease-btn" class="link-btn" title="Decrease font size" aria-label="Decrease font size">
                    <span class="font-control-symbol" aria-hidden="true">‚àí</span>
                </button>
                <button id="font-increase-btn" class="link-btn" title="Increase font size" aria-label="Increase font size">
                    <span class="font-control-symbol" aria-hidden="true">+</span>
                </button>
                <button id="theme-toggle-btn" class="link-btn theme-toggle" title="Toggle dark/light mode" aria-label="Toggle dark/light mode">
                    <span id="theme-icon" aria-hidden="true">üåô</span>
                </button>
                <button id="syntax-guide-btn" class="link-btn" title="WABA Syntax Guide" aria-label="Open WABA syntax guide">
                    <span aria-hidden="true">üìñ</span>
                </button>
            </div>
        </div>

        <!-- Introduction Section -->
        <div class="intro-section" id="intro-section">
            <div class="intro-content">
                <p class="intro-status" id="intro-status">‚è≥ Loading Clingo WASM...</p>
                <p class="intro-tagline">
                    <strong>WABA</strong> (Weighted Assumption-Based Argumentation) combines algebraic semirings and monoids
                    to enable flexible reasoning with weighted arguments and budget-constrained attack resolution.
                </p>
                <div class="intro-steps">
                    <span>1Ô∏è‚É£ Configure semiring/monoid</span>
                    <span>2Ô∏è‚É£ Choose example or write framework</span>
                    <span>3Ô∏è‚É£ Run WABA and explore results</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- Configuration Panel -->
                <section class="panel config-panel" data-panel="config" role="region" aria-label="Configuration">
                    <div class="panel-header">
                        <h3>Configuration</h3>
                        <button class="panel-toggle" aria-expanded="true" aria-controls="panel-config-content" aria-label="Toggle configuration panel">
                            <span class="icon-collapse">‚àí</span>
                            <span class="icon-expand" hidden>+</span>
                        </button>
                    </div>
                    <div class="panel-content" id="panel-config-content">
                    <div class="config-grid">
                        <div class="config-item">
                            <label for="semiring-select">Semiring (Weight Propagation)</label>
                            <select id="semiring-select" class="select">
                                <option value="godel">G√∂del (‚äó=min, ‚äï=max)</option>
                                <option value="tropical">Tropical (‚äó=+, ‚äï=min)</option>
                                <option value="arctic">Arctic (‚äó=+, ‚äï=max)</option>
                                <option value="lukasiewicz">≈Åukasiewicz (‚äó=bounded sum, ‚äï=bounded sum)</option>
                                <option value="bottleneck_cost">Bottleneck (‚äó=max, ‚äï=min)</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="monoid-select">
                                Monoid (Discard-Cost Aggregation)
                                <span class="info-hint" title="Aggregates discarded attack scores into beta_cost (repair cost). Higher attack scores cost more to discard.">‚ìò</span>
                            </label>
                            <select id="monoid-select" class="select">
                                <option value="max">MAX - Worst discarded attack</option>
                                <option value="sum">SUM - Total discard cost</option>
                                <option value="min">MIN - Best discarded attack</option>
                                <option value="count">COUNT - Number of discards</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label title="Attack score meaning (weight W)">
                                Attack Score Meaning (W)
                                <span class="info-hint" title="What attack weight W represents. Either way, discarding costs more for higher W (beta_cost is always a COST).">‚ìò</span>
                            </label>
                            <div id="polarity-display" class="config-value" style="padding: var(--space-xs) var(--space-sm); background: var(--bg-tertiary); border-radius: var(--radius-sm); color: var(--text-tertiary); font-size: var(--text-sm); opacity: 0.7; font-style: italic;">
                                Strength/Reward (‚Üë stronger ‚Üí costlier to discard)
                            </div>
                            <!-- Hidden select for programmatic access -->
                            <select id="polarity-select" class="select" style="display: none;">
                                <option value="strength">Strength/Reward (‚Üë stronger ‚Üí costlier to discard)</option>
                                <option value="cost">Cost/Weakness (‚Üë weaker ‚Üí costlier to discard)</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label title="Budget constraint applies to beta_cost (repair cost)">
                                Budget Constraint Type
                                <span class="info-hint" title="Upper Bound: allow discards only if beta_cost ‚â§ Œ≤ (standard). Lower Bound: force discards so beta_cost ‚â• Œ≤ (advanced).">‚ìò</span>
                            </label>
                            <div id="comparator-display" class="config-value" style="padding: var(--space-xs) var(--space-sm); background: var(--bg-tertiary); border-radius: var(--radius-sm); color: var(--text-tertiary); font-size: var(--text-sm); opacity: 0.7; font-style: italic;">
                                Upper Bound (beta_cost ‚â§ Œ≤)
                            </div>
                            <!-- Hidden select for programmatic access -->
                            <select id="comparator-select" class="select" style="display: none;">
                                <option value="ub">Upper Bound (beta_cost ‚â§ Œ≤)</option>
                                <option value="lb">Lower Bound (beta_cost ‚â• Œ≤)</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="semantics-select">
                                Semantics
                                <span class="info-hint" title="Only verified implementations from WABA repository">‚ìò</span>
                            </label>
                            <select id="semantics-select" class="select">
                                <option value="stable" selected>Stable</option>
                                <option value="admissible">Admissible</option>
                                <option value="complete">Complete</option>
                                <option value="grounded">Grounded</option>
                                <option value="preferred">Preferred</option>
                                <option value="semistable">Semi-Stable</option>
                                <option value="staged">Staged</option>
                                <option value="ideal">Ideal</option>
                                <option value="cf">Conflict-Free</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="optimize-select">
                                Optimization Objective
                                <span class="info-hint" id="opt-dir-hint" title="What to optimize: repair cost (beta_cost) is standard. Advanced: can add reward objectives.">‚ìò</span>
                            </label>
                            <select id="optimize-select" class="select">
                                <option value="minimize" selected>Minimize Repair Cost (beta_cost)</option>
                                <option value="maximize">Maximize Reward (kept attacks)</option>
                            </select>
                            <div id="opt-dir-warning" class="warning-message" style="display: none; margin-top: 4px; font-size: 0.85em; color: var(--warning-color);">
                                ‚ö†Ô∏è Maximizing reward is a separate objective from minimizing beta_cost
                            </div>
                        </div>

                        <div class="config-item">
                            <label for="opt-mode-select">Optimization Mode</label>
                            <select id="opt-mode-select" class="select">
                                <option value="ignore" selected>Enumerate All Extensions</option>
                                <option value="optN">Find Optimal Extensions Only</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="constraint-select">
                                Budget Constraint
                                <span class="info-hint" title="Constrains beta_cost (repair cost). UB: only allow low-cost repairs. LB: force higher-cost repairs (advanced).">‚ìò</span>
                            </label>
                            <select id="constraint-select" class="select">
                                <option value="none" selected>None (Enumerate All)</option>
                                <option value="ub">Upper Bound (beta_cost ‚â§ Œ≤)</option>
                                <option value="lb">Lower Bound (beta_cost ‚â• Œ≤)</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="budget-input" id="budget-input-label">
                                Budget Threshold (Œ≤)
                                <span class="info-hint" title="Threshold for beta_cost. With UB: only extensions with repair cost ‚â§ Œ≤ are allowed.">‚ìò</span>
                            </label>
                            <input type="number" id="budget-input" class="select" value="100" min="0" max="1000">
                        </div>

                        <div class="config-item" id="num-models-container">
                            <label for="num-models-input">Max Models (0 = no limit)</label>
                            <input type="number" id="num-models-input" class="select" value="0" min="0" max="100">
                        </div>

                        <div class="config-item">
                            <label for="timeout-input" title="Maximum execution time in seconds">Timeout (seconds)</label>
                            <input type="number" id="timeout-input" class="select" value="60" min="5" max="600" step="5">
                        </div>

                        <div class="config-item">
                            <label for="example-select">Load Example</label>
                            <select id="example-select" class="select">
                                <option value="">-- Select Example --</option>
                                <option value="simple">Simple - Mixed Attacks</option>
                                <option value="linear">Linear Topology</option>
                                <option value="cycle">Cycle Topology</option>
                                <option value="tree">Tree Topology</option>
                                <option value="complete" selected>Complete Topology</option>
                                <option value="mixed">Mixed Topology</option>
                                <option value="isolated">Isolated Components</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="file-upload-btn">Upload Framework</label>
                            <input type="file" id="file-upload-input" accept=".lp,.waba" class="file-upload-hidden">
                            <button id="file-upload-btn" class="select file-upload-button">üìÅ Choose File (.lp / .waba)</button>
                        </div>

                        <div class="config-item checkbox-container">
                            <label class="checkbox-label">
                                <input type="checkbox" id="flat-constraint" class="checkbox-input"> Flat-WABA Constraint
                            </label>
                        </div>
                    </div>
                    </div>
                </section>

                <!-- Editor Container -->
                <section class="panel editor-panel" data-panel="editor" role="region" aria-label="Framework Editor">
                    <div class="panel-header">
                        <h3>Framework Definition</h3>
                        <button class="panel-toggle" aria-expanded="true" aria-controls="panel-editor-content" aria-label="Toggle editor panel">
                            <span class="icon-collapse">‚àí</span>
                            <span class="icon-expand" hidden>+</span>
                        </button>
                    </div>
                    <div class="panel-content" id="panel-editor-content">
                    <div class="editor-header">
                        <div class="editor-controls">
                            <select id="input-mode" class="select input-mode-select" aria-label="Select input mode">
                                <option value="simple">Simple Editor</option>
                                <option value="advanced">Advanced Mode (ASP)</option>
                            </select>
                        </div>
                        <div class="download-buttons">
                            <button id="run-btn" class="run-btn" aria-label="Execute WABA framework">‚ñ∂Ô∏è Run WABA</button>
                            <button id="download-lp-btn" class="clear-btn" aria-label="Download current framework as .lp file">üíæ .lp</button>
                            <button id="download-waba-btn" class="clear-btn" aria-label="Download current framework as .waba file">üíæ .waba</button>
                        </div>
                    </div>

                    <!-- Advanced Mode: Code Editor -->
                    <textarea id="code-editor" class="code-editor code-editor-textarea" placeholder="Enter your WABA framework here...
% Lines starting with % are comments

Example:
assumption(a).
assumption(b).
weight(a, 80).
weight(b, 60).
head(r1, c_a). body(r1, b).
contrary(a, c_a).
contrary(b, c_b)."></textarea>

                    <!-- Simple Mode: Structured Input -->
                    <div id="simple-mode" class="simple-mode">
                        <!-- Description Box (shown only if description exists) -->
                        <div id="simple-description-box" class="simple-description-box" hidden>
                            <div class="description-header">
                                <span>Description</span>
                                <button id="simple-remove-description-btn" class="remove-description-btn" title="Remove description">
                                    ‚úï
                                </button>
                            </div>
                            <textarea id="simple-description-content" class="description-content" placeholder="Enter description here..." rows="3"></textarea>
                        </div>

                        <!-- Add Comment Button (shown only when no description exists) -->
                        <div id="simple-add-comment-container" class="simple-add-comment-container">
                            <button id="simple-add-comment-btn" class="add-comment-btn">
                                <span>üí¨ Add Description</span>
                            </button>
                        </div>

                        <div class="simple-grid">
                            <div class="simple-field">
                                <label for="assumptions-input">Assumptions (one per line)</label>
                                <span class="comment-hint">Lines starting with % are comments</span>
                                <textarea id="assumptions-input" class="simple-textarea" placeholder="a
b
c"></textarea>
                            </div>

                            <div class="simple-field">
                                <label for="rules-input">Rules (format: head <- body1, body2)</label>
                                <span class="comment-hint">Lines starting with % are comments</span>
                                <textarea id="rules-input" class="simple-textarea" placeholder="c_a <- b"></textarea>
                            </div>

                            <div class="simple-field">
                                <label for="contraries-input">Contraries (format: (assumption, contrary))</label>
                                <span class="comment-hint">Lines starting with % are comments</span>
                                <textarea id="contraries-input" class="simple-textarea" placeholder="(a, c_a)
(b, c_b)"></textarea>
                            </div>

                            <div class="simple-field">
                                <label for="weights-input">Weights (format: atom: weight)</label>
                                <span class="comment-hint">Lines starting with % are comments</span>
                                <textarea id="weights-input" class="simple-textarea" placeholder="a: 80
b: 60
c_a: 70"></textarea>
                            </div>
                        </div>
                    </div>
                    </div>
                </section>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Graph Visualization -->
                <section class="panel graph-panel" data-panel="graph" role="region" aria-label="Argumentation Graph">
                    <div class="panel-header">
                        <h3>Argumentation Graph</h3>
                        <button class="panel-toggle" aria-expanded="true" aria-controls="panel-graph-content" aria-label="Toggle graph panel">
                            <span class="icon-collapse">‚àí</span>
                            <span class="icon-expand" hidden>+</span>
                        </button>
                    </div>
                    <div class="panel-content" id="panel-graph-content">
                    <div class="graph-header">
                        <div class="graph-mode-selector" role="radiogroup" aria-label="Graph visualization mode">
                            <label class="mode-option">
                                <input type="radio" name="graph-mode" value="standard" checked aria-label="Standard graph mode - show all nodes and edges">
                                <span>Standard</span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="graph-mode" value="assumption-direct" aria-label="Assumption-Direct mode - show only assumptions with direct attacks">
                                <span>Assumption-Direct</span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="graph-mode" value="assumption-branching" aria-label="Assumption-Branching mode - show assumptions with full branching attack paths">
                                <span>Assumption-Branching</span>
                            </label>
                        </div>
                        <div class="graph-controls">
                            <button id="reset-layout-btn" class="clear-btn" aria-label="Reset graph layout">üîÑ Reset Layout</button>
                            <button id="legend-toggle-btn" class="clear-btn" aria-label="Toggle graph legend" aria-expanded="false">üìñ Legend</button>
                            <button id="fullscreen-btn" class="clear-btn" aria-label="Toggle fullscreen mode">‚õ∂ Fullscreen</button>
                            <button id="export-png-btn" class="clear-btn" aria-label="Export graph as PNG">üíæ PNG</button>
                            <button id="export-pdf-btn" class="clear-btn" aria-label="Export graph as PDF">üìÑ PDF</button>
                        </div>
                    </div>

                    <!-- Graph Legend (Collapsible) -->
                    <div id="graph-legend" class="graph-legend" role="region" aria-label="Graph visualization legend" hidden>
                        <div class="legend-section">
                            <h4>Node Types</h4>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <span class="legend-symbol node-assumption" aria-hidden="true"></span>
                                    <span>Assumption</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-symbol node-derived" aria-hidden="true"></span>
                                    <span>Joint Attack Node</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-symbol node-top" aria-hidden="true"></span>
                                    <span>‚ä§ (Facts)</span>
                                </div>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Edge Types</h4>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <span class="legend-symbol edge-derived" aria-hidden="true"></span>
                                    <span>Attack</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-symbol edge-joint" aria-hidden="true"></span>
                                    <span>Joint Attack</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-symbol edge-fact" aria-hidden="true"></span>
                                    <span>Fact-based Attack</span>
                                </div>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Attack States</h4>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <span class="legend-symbol edge-active" aria-hidden="true"></span>
                                    <span>Active Attack</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-symbol edge-discarded" aria-hidden="true"></span>
                                    <span>Discarded Attack</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="cy" class="graph-canvas" role="img" aria-label="Argumentation graph visualization">
                        <!-- Empty State -->
                        <div id="graph-empty-state" class="graph-empty-state" role="status" hidden>
                            <div class="empty-state-icon" aria-hidden="true">üìä</div>
                            <h3>No Graph to Display</h3>
                            <p>Run a WABA framework to visualize the argumentation graph.</p>
                            <p class="empty-state-hint">Click "‚ñ∂Ô∏è Run WABA" above to get started.</p>
                        </div>
                    </div>

                    <!-- Isolated Assumptions Banner -->
                    <div id="isolated-assumptions-banner" class="isolated-assumptions-banner" hidden>
                        <strong>‚ö†Ô∏è Isolated Assumptions:</strong>
                        <span id="isolated-assumptions-list"></span>
                    </div>
                    </div>
                </section>

                <!-- Output Container -->
                <section class="panel output-panel" data-panel="output" role="region" aria-label="Results">
                    <div class="panel-header">
                        <h3>Results</h3>
                        <button class="panel-toggle" aria-expanded="true" aria-controls="panel-output-content" aria-label="Toggle output panel">
                            <span class="icon-collapse">‚àí</span>
                            <span class="icon-expand" hidden>+</span>
                        </button>
                    </div>
                    <div class="panel-content" id="panel-output-content">
                    <div class="output-header">
                        <button id="clear-btn" class="clear-btn" aria-label="Clear output results">üóëÔ∏è Clear Output</button>
                    </div>
                    <div id="output" class="output" role="log" aria-live="polite" aria-atomic="false">
                        <!-- Output Empty State (inside output panel) -->
                        <div id="output-empty-state" class="output-empty-state" role="status">
                            <div class="empty-state-icon" aria-hidden="true">üìã</div>
                            <h3>No Results Yet</h3>
                            <p>Run a WABA framework to see the output here.</p>
                        </div>
                    </div>
                    <div id="stats" class="stats" role="status" aria-live="polite"></div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Analysis Panel (Full Width) -->
        <section class="panel analysis-panel" data-panel="analysis" role="region" aria-label="Analysis Tools">
            <div class="panel-header">
                <h3>üìä Analysis & Export</h3>
                <button class="panel-toggle" aria-expanded="true" aria-controls="panel-analysis-content" aria-label="Toggle analysis panel">
                    <span class="icon-collapse">‚àí</span>
                    <span class="icon-expand" hidden>+</span>
                </button>
            </div>
            <div class="panel-content" id="panel-analysis-content">
                <!-- Unified analysis section (buttons and content added dynamically) -->
                <div id="export-section" class="analysis-section">
                    <!-- Button group and content inserted by JS -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <div class="footer">
            <p>WABA Playground | Powered by <a href="https://potassco.org/clingo/" target="_blank">Clingo</a> & <a href="https://visjs.github.io/vis-network/" target="_blank">vis.js</a></p>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" role="status" aria-live="assertive" hidden>
        <div class="loading-content">
            <div class="loading-spinner" aria-hidden="true"></div>
            <h3 id="loading-text">Running WABA...</h3>
            <p id="loading-subtext">Computing extensions and visualizing results</p>
            <p id="loading-elapsed" class="loading-elapsed">Elapsed: 0.0s</p>
        </div>
    </div>

    <!-- Documentation Modal -->
    <div id="syntax-guide-modal" class="modal" role="dialog" aria-labelledby="syntax-guide-title" aria-hidden="true" hidden>
        <div class="modal-content modal-content-large">
            <div class="modal-header">
                <h2 id="syntax-guide-title">üìö WABA Playground Documentation</h2>
                <button id="syntax-guide-close" class="modal-close" aria-label="Close documentation">&times;</button>
            </div>

            <!-- Tab Navigation -->
            <div class="doc-tabs" role="tablist">
                <button class="doc-tab active" role="tab" aria-selected="true" aria-controls="tab-getting-started" data-tab="getting-started">
                    üöÄ Getting Started
                </button>
                <button class="doc-tab" role="tab" aria-selected="false" aria-controls="tab-syntax" data-tab="syntax">
                    üìù Framework Syntax
                </button>
                <button class="doc-tab" role="tab" aria-selected="false" aria-controls="tab-config" data-tab="config">
                    ‚öôÔ∏è Configuration
                </button>
                <button class="doc-tab" role="tab" aria-selected="false" aria-controls="tab-results" data-tab="results">
                    üìä Understanding Results
                </button>
            </div>

            <div class="modal-body">
                <!-- Getting Started Tab -->
                <div id="tab-getting-started" class="doc-tab-content active" role="tabpanel">
                    <h3>Welcome to WABA Playground! üëã</h3>
                    <p><strong>WABA</strong> (Weighted Assumption-Based Argumentation) combines algebraic semirings and monoids to enable flexible reasoning with weighted arguments and budget-constrained attack resolution.</p>

                    <div class="doc-card">
                        <h4>üéØ Quick Start Workflow</h4>
                        <ol class="workflow-steps">
                            <li><strong>Configure:</strong> Choose your semiring (weight propagation) and monoid (cost aggregation)</li>
                            <li><strong>Define Framework:</strong> Load an example or write your own in Simple/Advanced mode</li>
                            <li><strong>Run:</strong> Click "‚ñ∂Ô∏è Run WABA" to compute extensions</li>
                            <li><strong>Explore:</strong> View results and interact with the argumentation graph</li>
                        </ol>
                    </div>

                    <div class="doc-card">
                        <h4>üí° Key Concepts</h4>
                        <dl class="concept-list">
                            <dt>Assumptions</dt>
                            <dd>Defeasible statements that can be in or out of extensions</dd>

                            <dt>Weights</dt>
                            <dd>Positive integer costs/rewards assigned to arguments</dd>

                            <dt>Attacks</dt>
                            <dd>Relations where one argument challenges another</dd>

                            <dt>Extensions</dt>
                            <dd>Consistent sets of assumptions that defend themselves from attacks</dd>

                            <dt>Budget</dt>
                            <dd>Maximum cost allowed for discarding attacks (optional)</dd>
                        </dl>
                    </div>

                    <div class="doc-card">
                        <h4>üìÇ File Formats</h4>
                        <p>Upload your frameworks in two formats:</p>
                        <ul>
                            <li><strong>.waba</strong> - Simple, human-readable format (recommended for beginners)</li>
                            <li><strong>.lp</strong> - Advanced ASP format with full expressiveness</li>
                        </ul>
                    </div>
                </div>

                <!-- Framework Syntax Tab -->
                <div id="tab-syntax" class="doc-tab-content" role="tabpanel" hidden>
                    <h3>Framework Syntax</h3>

                    <div class="syntax-section">
                        <h4>üìÑ Simple Mode (.waba Format)</h4>
                        <p>Simple Mode uses a structured text format with four sections. Comments use <code>%</code>.</p>

                        <details class="syntax-details" open>
                            <summary><strong>1. Assumptions</strong></summary>
                            <pre><code>a
b
c</code></pre>
                            <p>One assumption per line. These are defeasible atoms that can be in or out of extensions.</p>
                        </details>

                        <details class="syntax-details">
                            <summary><strong>2. Rules</strong></summary>
                            <pre><code>conclusion ‚Üê premise1, premise2
attack ‚Üê a</code></pre>
                            <p>One rule per line using <code>‚Üê</code> (or <code>&lt;-</code>) to separate head from body.</p>
                        </details>

                        <details class="syntax-details">
                            <summary><strong>3. Contraries (Attacks)</strong></summary>
                            <pre><code>a: attack_element
b: conclusion</code></pre>
                            <p>Format: <code>attacked: attacker</code><br>
                            <strong>‚ö†Ô∏è Direction:</strong> <code>attacker</code> attacks <code>attacked</code> (not the reverse)</p>
                        </details>

                        <details class="syntax-details">
                            <summary><strong>4. Weights</strong></summary>
                            <pre><code>a: 80
b: 60
attack_element: 70</code></pre>
                            <p>Format: <code>atom: weight</code>. Assigns positive integer weights (default: 1).</p>
                        </details>

                        <details class="syntax-details">
                            <summary><strong>Complete .waba Example</strong></summary>
                            <pre><code>% Medical triage example
a
b

attack_element ‚Üê a

b: attack_element

a: 80
b: 60
attack_element: 70</code></pre>
                        </details>
                    </div>

                    <div class="syntax-section">
                        <h4>‚ö° Advanced Mode (.lp Format)</h4>
                        <p>Advanced Mode uses Answer Set Programming (ASP) syntax with WABA predicates.</p>

                        <details class="syntax-details">
                            <summary><strong>Predicates Reference</strong></summary>
                            <table class="syntax-table">
                                <tr>
                                    <th>Predicate</th>
                                    <th>Syntax</th>
                                    <th>Description</th>
                                </tr>
                                <tr>
                                    <td><code>assumption</code></td>
                                    <td><code>assumption(a).</code></td>
                                    <td>Declares a defeasible assumption</td>
                                </tr>
                                <tr>
                                    <td><code>weight</code></td>
                                    <td><code>weight(a, 80).</code></td>
                                    <td>Assigns weight to an atom</td>
                                </tr>
                                <tr>
                                    <td><code>head/body</code></td>
                                    <td><code>head(r1, c). body(r1, a).</code></td>
                                    <td>Defines inference rules</td>
                                </tr>
                                <tr>
                                    <td><code>contrary</code></td>
                                    <td><code>contrary(a, c).</code></td>
                                    <td>c attacks a</td>
                                </tr>
                                <tr>
                                    <td><code>budget</code></td>
                                    <td><code>budget(100).</code></td>
                                    <td>Sets budget constraint</td>
                                </tr>
                            </table>
                        </details>

                        <details class="syntax-details">
                            <summary><strong>Complete .lp Example</strong></summary>
                            <pre><code>% Assumptions
assumption(a).
assumption(b).

% Weights
weight(a, 80).
weight(b, 60).
weight(attack_element, 70).

% Rules
head(r1, attack_element).
body(r1, a).

% Contraries
contrary(b, attack_element).

% Budget
budget(100).</code></pre>
                        </details>
                    </div>
                </div>

                <!-- Configuration Tab -->
                <div id="tab-config" class="doc-tab-content" role="tabpanel" hidden>
                    <h3>Configuration Options</h3>

                    <div class="config-section">
                        <h4>üî¢ Semiring (Weight Propagation)</h4>
                        <p>Controls how weights propagate through inference rules.</p>

                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Semiring</th>
                                    <th>Conjunction (‚äó)</th>
                                    <th>Disjunction (‚äï)</th>
                                    <th>Use Case</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>G√∂del</strong></td>
                                    <td>min</td>
                                    <td>max</td>
                                    <td>Fuzzy logic, weakest-link reasoning</td>
                                </tr>
                                <tr>
                                    <td><strong>Tropical</strong></td>
                                    <td>+</td>
                                    <td>min</td>
                                    <td>Additive costs, shortest paths</td>
                                </tr>
                                <tr>
                                    <td><strong>Arctic</strong></td>
                                    <td>+</td>
                                    <td>max</td>
                                    <td>Reward accumulation, longest paths</td>
                                </tr>
                                <tr>
                                    <td><strong>≈Åukasiewicz</strong></td>
                                    <td>bounded sum</td>
                                    <td>bounded sum</td>
                                    <td>Bounded probability-like reasoning</td>
                                </tr>
                                <tr>
                                    <td><strong>Bottleneck</strong></td>
                                    <td>max</td>
                                    <td>min</td>
                                    <td>Worst-case optimization</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="config-section">
                        <h4>üìä Monoid (Cost Aggregation)</h4>
                        <p>Determines how costs of discarded attacks are combined.</p>

                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Monoid</th>
                                    <th>Operation</th>
                                    <th>Meaning</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>MAX</strong></td>
                                    <td>max(weights)</td>
                                    <td>Worst single attack cost</td>
                                </tr>
                                <tr>
                                    <td><strong>SUM</strong></td>
                                    <td>Œ£ weights</td>
                                    <td>Total cost of all discarded attacks</td>
                                </tr>
                                <tr>
                                    <td><strong>MIN</strong></td>
                                    <td>min(weights)</td>
                                    <td>Best single attack cost</td>
                                </tr>
                                <tr>
                                    <td><strong>COUNT</strong></td>
                                    <td>count(attacks)</td>
                                    <td>Number of discarded attacks</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="config-section">
                        <h4>üéØ Semantics</h4>
                        <p>Defines admissibility criteria for extensions.</p>

                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Semantics</th>
                                    <th>Description</th>
                                    <th>Extensions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Stable</strong></td>
                                    <td>Conflict-free + all external arguments attacked</td>
                                    <td>0 or more</td>
                                </tr>
                                <tr>
                                    <td><strong>Preferred</strong></td>
                                    <td>Maximal complete extensions</td>
                                    <td>1 or more</td>
                                </tr>
                                <tr>
                                    <td><strong>Complete</strong></td>
                                    <td>Admissible + contains all defended arguments</td>
                                    <td>1 or more</td>
                                </tr>
                                <tr>
                                    <td><strong>Grounded</strong></td>
                                    <td>Minimal complete extension</td>
                                    <td>Exactly 1</td>
                                </tr>
                                <tr>
                                    <td><strong>Semi-Stable</strong></td>
                                    <td>Admissible with maximal range</td>
                                    <td>1 or more</td>
                                </tr>
                                <tr>
                                    <td><strong>Admissible</strong></td>
                                    <td>Conflict-free + defends all members</td>
                                    <td>1 or more</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="config-section">
                        <h4>üéöÔ∏è Optimization</h4>
                        <dl class="config-dl">
                            <dt><strong>Minimize (Cost Semantics)</strong></dt>
                            <dd>Find extensions with lowest cost. Weights represent costs to avoid.</dd>

                            <dt><strong>Maximize (Reward Semantics)</strong></dt>
                            <dd>Find extensions with highest reward. Weights represent benefits to pursue.</dd>

                            <dt><strong>None (Enumerate All)</strong></dt>
                            <dd>Show all extensions without optimization.</dd>
                        </dl>
                    </div>

                    <div class="config-section">
                        <h4>üí∞ Budget Constraint</h4>
                        <dl class="config-dl">
                            <dt><strong>Upper Bound (cost ‚â§ Œ≤)</strong></dt>
                            <dd>Only allow extensions where total cost doesn't exceed budget Œ≤.</dd>

                            <dt><strong>Lower Bound (quality ‚â• Œ≤)</strong></dt>
                            <dd>Only allow extensions meeting minimum quality threshold Œ≤.</dd>

                            <dt><strong>None</strong></dt>
                            <dd>No budget constraints (enumerate all valid extensions).</dd>
                        </dl>
                    </div>
                </div>

                <!-- Understanding Results Tab -->
                <div id="tab-results" class="doc-tab-content" role="tabpanel" hidden>
                    <h3>Understanding Results</h3>

                    <div class="results-section">
                        <h4>üìã Output Panel</h4>
                        <p>The Results panel displays all computed extensions with detailed information:</p>

                        <div class="doc-card">
                            <h5>Extension Card Format</h5>
                            <pre><code><strong>Extension 1</strong> (Cost: 0)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<span class="text-in">‚úì IN:</span> a, b, c
<span class="text-out">‚úó OUT:</span> d, e
<span class="text-attack">‚öîÔ∏è ATTACKS:</span>
  c attacks d (weight: 50) [ACTIVE]
  b attacks e (weight: 30) [DISCARDED, cost: 30]
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</code></pre>
                        </div>

                        <dl class="results-dl">
                            <dt><strong>Extension Number</strong></dt>
                            <dd>Unique identifier for each solution (click to highlight in graph)</dd>

                            <dt><strong>Cost/Reward Value</strong></dt>
                            <dd>Total optimization value based on monoid aggregation</dd>

                            <dt><strong>IN (Green ‚úì)</strong></dt>
                            <dd>Assumptions accepted in this extension</dd>

                            <dt><strong>OUT (Red ‚úó)</strong></dt>
                            <dd>Assumptions rejected/not selected</dd>

                            <dt><strong>ATTACKS</strong></dt>
                            <dd>
                                <ul>
                                    <li><strong>[ACTIVE]</strong> - Attack successfully defeats target</li>
                                    <li><strong>[DISCARDED]</strong> - Attack blocked (contributes to cost)</li>
                                </ul>
                            </dd>
                        </dl>
                    </div>

                    <div class="results-section">
                        <h4>üó∫Ô∏è Argumentation Graph</h4>
                        <p>Interactive visualization of your framework structure:</p>

                        <div class="graph-legend-doc">
                            <h5>Node Types</h5>
                            <ul>
                                <li><span class="legend-node assumption">‚óè</span> <strong>Assumption</strong> - Defeasible argument</li>
                                <li><span class="legend-node derived">‚óè</span> <strong>Joint Attack Node</strong> - Combined attack from multiple sources</li>
                                <li><span class="legend-node top">‚óè</span> <strong>‚ä§ (Top)</strong> - Facts/always true</li>
                            </ul>

                            <h5>Node Colors (when extension selected)</h5>
                            <ul>
                                <li><span class="legend-node in">‚óè</span> <strong>Green</strong> - Argument IN extension</li>
                                <li><span class="legend-node out">‚óè</span> <strong>Red</strong> - Argument OUT/defeated</li>
                                <li><span class="legend-node gray">‚óè</span> <strong>Gray</strong> - Not involved</li>
                            </ul>

                            <h5>Edge Types</h5>
                            <ul>
                                <li><span class="legend-edge attack">‚Üí</span> <strong>Solid Red</strong> - Active attack</li>
                                <li><span class="legend-edge discarded">‚§ç</span> <strong>Dashed Gray</strong> - Discarded attack</li>
                                <li><span class="legend-edge joint">‚Üí</span> <strong>Purple</strong> - Joint attack component</li>
                            </ul>
                        </div>
                    </div>

                    <div class="results-section">
                        <h4>üéÆ Graph Interaction</h4>
                        <ul class="interaction-list">
                            <li><strong>Click extension card</strong> - Highlight in graph with color coding</li>
                            <li><strong>Click node</strong> - View node details (weight, type, status)</li>
                            <li><strong>Click edge</strong> - View attack details (weight, active/discarded)</li>
                            <li><strong>Drag nodes</strong> - Rearrange layout manually</li>
                            <li><strong>Scroll/pinch</strong> - Zoom in/out</li>
                            <li><strong>Reset Layout</strong> - Restore default physics-based positioning</li>
                        </ul>
                    </div>

                    <div class="results-section">
                        <h4>üìà Statistics</h4>
                        <p>Summary metrics displayed below the output:</p>
                        <ul>
                            <li><strong>Total Extensions</strong> - Number of solutions found</li>
                            <li><strong>Computation Time</strong> - Solver execution time</li>
                            <li><strong>Optimal Cost/Reward</strong> - Best value (if optimization enabled)</li>
                        </ul>
                    </div>

                    <div class="results-section">
                        <h4>üíæ Export Options</h4>
                        <ul>
                            <li><strong>üíæ .lp / .waba</strong> - Download current framework</li>
                            <li><strong>üíæ PNG</strong> - Export graph as image</li>
                            <li><strong>üìÑ PDF</strong> - Export graph as PDF document</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application (ES6 Module) -->
    <!-- Cache-busting: increment version to force reload after changes -->
    <script type="module" src="app.js?v=20260105-1"></script>
</body>
</html>
