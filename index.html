<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CRITICAL: Set base URL for GitHub Pages project repository (conditional) -->
    <script>
        // Only set base tag for GitHub Pages, not for localhost
        if (window.location.hostname === 'dasaro.github.io') {
            const base = document.createElement('base');
            base.href = '/waba-playground/';
            document.head.appendChild(base);
        }
    </script>

    <title>WABA Playground - Interactive Framework Explorer</title>
    <link rel="stylesheet" href="style.css">
    <!-- vis.js for network visualization -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/vis-network/styles/vis-network.min.css">

    <!-- Configure Emscripten Module BEFORE loading clingo.web.js -->
    <script>
        // Tell Emscripten where to find WASM files on GitHub Pages
        var Module = {
            locateFile: function(path) {
                console.log('[Module.locateFile] Called with path:', path);
                console.log('[Module.locateFile] window.location:', window.location.href);
                console.log('[Module.locateFile] hostname:', window.location.hostname);

                // For WASM files, use absolute URL (critical for GitHub Pages project repos)
                if (path.endsWith('.wasm') || path.endsWith('.worker.js')) {
                    // HARDCODED for GitHub Pages project repo (most reliable)
                    // WASM files are in dist/ subdirectory
                    const isGitHubPages = window.location.hostname === 'dasaro.github.io';
                    const hasProjectPath = window.location.pathname.includes('/waba-playground');

                    console.log('[Module.locateFile] isGitHubPages:', isGitHubPages);
                    console.log('[Module.locateFile] hasProjectPath:', hasProjectPath);

                    if (isGitHubPages && hasProjectPath) {
                        const fullUrl = 'https://dasaro.github.io/waba-playground/dist/' + path;
                        console.log('[Module.locateFile] ‚úì GitHub Pages project mode:', fullUrl);
                        return fullUrl;
                    } else if (isGitHubPages && !hasProjectPath) {
                        // Weird state - on GitHub Pages but not in project path?
                        console.warn('[Module.locateFile] ‚ö†Ô∏è On GitHub Pages but not in project path!');
                        const fullUrl = 'https://dasaro.github.io/waba-playground/dist/' + path;
                        console.log('[Module.locateFile] ‚úì Forcing project path:', fullUrl);
                        return fullUrl;
                    }

                    // Fallback for local development
                    const currentUrl = window.location.href;
                    const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/') + 1);
                    const fullUrl = baseUrl + 'dist/' + path;
                    console.log('[Module.locateFile] ‚úì Local mode:', fullUrl);
                    return fullUrl;
                }
                console.log('[Module.locateFile] Passthrough:', path);
                return path;
            }
        };
    </script>
    <script src="clingo.web.js?v=20251227-9"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>WABA Playground</h1>
                <p class="subtitle">Interactive Weighted Assumption-Based Argumentation Framework Explorer</p>
            </div>
            <div class="header-links">
                <button id="font-decrease-btn" class="link-btn" title="Decrease font size">
                    <span style="font-size: 1.2em; font-weight: bold;">‚àí</span>
                </button>
                <button id="font-increase-btn" class="link-btn" title="Increase font size">
                    <span style="font-size: 1.2em; font-weight: bold;">+</span>
                </button>
                <button id="theme-toggle-btn" class="link-btn theme-toggle" title="Toggle dark/light mode">
                    <span id="theme-icon">üåô</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- Configuration Panel -->
                <div class="config-panel">
                    <h3>Configuration</h3>

                    <div class="config-grid">
                        <div class="config-item">
                            <label for="semiring-select">Semiring (Weight Propagation)</label>
                            <select id="semiring-select" class="select">
                                <option value="godel">G√∂del (‚äó=min, ‚äï=max)</option>
                                <option value="tropical">Tropical (‚äó=+, ‚äï=min)</option>
                                <option value="arctic">Arctic (‚äó=+, ‚äï=max)</option>
                                <option value="lukasiewicz">≈Åukasiewicz (‚äó=bounded sum, ‚äï=bounded sum)</option>
                                <option value="bottleneck_cost">Bottleneck (‚äó=max, ‚äï=min)</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="monoid-select">Monoid (Cost Aggregation)</label>
                            <select id="monoid-select" class="select">
                                <option value="max">MAX - Maximum Cost</option>
                                <option value="sum">SUM - Total Cost</option>
                                <option value="min">MIN - Minimum Cost</option>
                                <option value="count">COUNT - Number of Attacks</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="semantics-select">Semantics</label>
                            <select id="semantics-select" class="select">
                                <option value="stable">Stable Semantics</option>
                                <option value="cf">Conflict-Free Semantics</option>
                            </select>
                        </div>
                    </div>

                    <div class="config-grid">
                        <div class="config-item">
                            <label for="optimize-select">Optimization</label>
                            <select id="optimize-select" class="select">
                                <option value="none">None (Enumerate All)</option>
                                <option value="minimize">Minimize Cost</option>
                                <option value="maximize">Maximize Cost</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="constraint-select">Budget Constraint</label>
                            <select id="constraint-select" class="select">
                                <option value="ub">Upper Bound (cost ‚â§ Œ≤)</option>
                                <option value="lb">Lower Bound (quality ‚â• Œ≤)</option>
                                <option value="none">None</option>
                            </select>
                        </div>

                        <div class="config-item">
                            <label for="budget-input">Budget (Œ≤)</label>
                            <input type="number" id="budget-input" class="select" value="100" min="0" max="1000">
                        </div>
                    </div>

                    <div class="config-grid">
                        <div class="config-item">
                            <label for="num-models-input">Number of Models (0 = all)</label>
                            <input type="number" id="num-models-input" class="select" value="0" min="0" max="100">
                        </div>

                        <div class="config-item">
                            <label for="example-select">Load Example</label>
                            <select id="example-select" class="select">
                                <option value="">-- Select Example --</option>
                                <option value="simple">Simple - Mixed Attacks</option>
                                <option value="linear">Linear Topology</option>
                                <option value="cycle">Cycle Topology</option>
                                <option value="tree">Tree Topology</option>
                                <option value="complete">Complete Topology</option>
                                <option value="mixed">Mixed Topology</option>
                                <option value="isolated">Isolated Components</option>
                            </select>
                        </div>

                        <div class="config-item" style="display: flex; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                <input type="checkbox" id="flat-constraint" style="margin: 0;"> Flat-WABA Constraint
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Editor Container -->
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="editor-controls">
                            <h3>Framework Definition</h3>
                            <select id="input-mode" class="select" style="margin-left: 20px;">
                                <option value="simple">Simple Mode (ABA)</option>
                                <option value="advanced">Advanced Mode (ASP)</option>
                            </select>
                        </div>
                        <button id="run-btn" class="run-btn">‚ñ∂Ô∏è Run WABA</button>
                    </div>

                    <!-- Advanced Mode: Code Editor -->
                    <textarea id="code-editor" class="code-editor" style="display: none;" placeholder="Enter your WABA framework here...
Example:
assumption(a).
assumption(b).
weight(a, 80).
weight(b, 60).
head(r1, c_a). body(r1, b).
contrary(a, c_a).
contrary(b, c_b)."></textarea>

                    <!-- Simple Mode: Structured Input -->
                    <div id="simple-mode" class="simple-mode">
                        <div class="simple-grid">
                            <div class="simple-field">
                                <label>Assumptions (one per line)</label>
                                <textarea id="assumptions-input" class="simple-textarea" placeholder="a
b
c"></textarea>
                            </div>

                            <div class="simple-field">
                                <label>Rules (format: head <- body1, body2)</label>
                                <textarea id="rules-input" class="simple-textarea" placeholder="c_a <- b"></textarea>
                            </div>

                            <div class="simple-field">
                                <label>Contraries (format: (assumption, contrary))</label>
                                <textarea id="contraries-input" class="simple-textarea" placeholder="(a, c_a)
(b, c_b)"></textarea>
                            </div>

                            <div class="simple-field">
                                <label>Weights (format: atom: weight)</label>
                                <textarea id="weights-input" class="simple-textarea" placeholder="a: 80
b: 60
c_a: 70"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Graph Visualization -->
                <div class="graph-container" id="graph-container">
                    <div class="graph-header">
                        <h3>Argumentation Graph</h3>
                        <div class="graph-controls">
                            <button id="reset-layout-btn" class="clear-btn">üîÑ Reset Layout</button>
                            <button id="fullscreen-btn" class="clear-btn">‚õ∂ Fullscreen</button>
                        </div>
                    </div>
                    <div id="cy" class="graph-canvas"></div>
                </div>

                <!-- Output Container -->
                <div class="output-container">
                    <div class="output-header">
                        <h3>Results</h3>
                        <button id="clear-btn" class="clear-btn">üóëÔ∏è Clear Output</button>
                    </div>
                    <div id="output" class="output"></div>
                    <div id="stats" class="stats"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>WABA Playground | Powered by <a href="https://potassco.org/clingo/" target="_blank">Clingo</a> & <a href="https://visjs.github.io/vis-network/" target="_blank">vis.js</a></p>
        </div>
    </div>

    <!-- Load example frameworks -->
    <script src="examples.js"></script>
    <!-- Load main application -->
    <script src="app.js"></script>
</body>
</html>
